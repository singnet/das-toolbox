# DAS Toolbox

## Overview

**DAS Toolbox** is a CLI tool that simplifies the management of containerized services, OpenFaaS functions, and operations related to the Distributed Atomspace (DAS). It allows you to spin up databases, load MeTTa files, validate syntax, and more.

---

## Table of Contents

* [Requirements](#requirements)
* [Installation](#installation)

  * [APT Repository Ubuntu/Debian](#apt-repository-ubuntudebian)
  * [Local deb Package Ubuntu/Debian](#local-deb-package-ubuntudebian)
  * [Build from Source Linux macOS Windows](#build-from-source-linux-macos-windows)


* [General Syntax](#general-syntax)
* [Examples](#examples)

  * [Attention Broker](#attention-broker)
  * [Configuration](#configuration)
  * [Databases](#databases)
  * [MeTTa Files](#metta-files)
  * [DAS & DBMS Peers](#das--dbms-peers)
* [Help](#help)

  * [List All Command Groups](#list-all-command-groups)
  * [View Help for a Command Group](#view-help-for-a-command-group)
  * [Get Help for a Specific Subcommand](#get-help-for-a-specific-subcommand)
  * [Manual Pages (APT install only)](#manual-pages-apt-install-only)
* [Integration Tests](#integration-tests)
* [Troubleshooting](#troubleshooting)

  * [Docker permission denied](#docker-permission-denied)
  * [Temporary folder error](#temporary-folder-error)

---

## Requirements

### System Dependencies

* [Docker](https://www.docker.com/) — required for some commands that interact with containers.

### Python Dependencies

* Python **>= 3.10**
* `pip` (required if installing via pip)
* `virtualenv` (optional, recommended to isolate the environment)

> Note: `pip` is only required if you install via pip. On Ubuntu, you can install using the `.deb` package generated by `make build` without pip.

---

## Installation

### APT Repository (Ubuntu/Debian)

1. Set up the repository:

```bash
sudo bash -c "wget -O - http://45.77.4.33/apt-repo/setup.sh | bash"
```

2. Install the package:

```bash
sudo apt install das-toolbox
```

3. Verify the installation:

```bash
das-cli --help
```

> This method installs the `.deb` package directly. No `pip` or virtual environment is required.

---

### Local `.deb` Package (Ubuntu/Debian)

1. Build the package locally:

```bash
make build                 # generates the .deb file in dist/
```
2. Install the package (choose one of the methods below):

**Using APT (Recommended):**
```bash
sudo apt install ./dist/das-cli_<version>.deb
```

**Using dpkg:**
```bash
sudo dpkg -i dist/das-cli_<version>.deb
```

3. Verify the installation:

```bash
das-cli --help
```

> No `pip` or virtualenv needed.

---

### Build from Source (Linux, macOS, Windows)

1. Clone the repository and navigate to the project root:

```bash
git clone https://github.com/singnet/das-toolbox.git
```

2. (Optional but recommended) Create and activate a virtual environment:

```bash
python -m venv env
source env/bin/activate    # Linux/macOS
env\Scripts\activate       # Windows
```

3. Install the package using `pip`:

```bash
cd das-toolbox/das-cli
pip install .
```

4. Verify the installation:

```bash
das-cli --help
```

> This method works on all supported OSs (Linux, macOS, Windows) 

---

### General Syntax

The general syntax for using `das-cli` is:

```bash
das-cli <command> <subcommand> [options]
```

* `<command>` — the main module or functionality you want to access (e.g., `ab`, `query`).
* `<subcommand>` — a specific action within the command (e.g., `start`, `stop`).
* `[options]` — optional flags or parameters to modify the behavior of the subcommand (e.g., `--follow`, `--remote`).

---

### Examples

#### Attention Broker

```bash
# Start the Attention Broker module
das-cli ab start
```

---

#### Configuration

```bash
# Configure Redis or Mongo
das-cli config set
```

---

#### Databases

```bash
# Start databases
das-cli db start
```

---

#### MeTTa Files

```bash
# Validate a MeTTa file
das-cli metta check ./examples/data/animals.metta

# Load a MeTTa file into the system
das-cli metta load ./examples/data/animals.metta
```

---

#### DAS & DBMS Peers

```bash
# Start the DAS peer
das-cli dbms-adapter das-peer start

# Run the DBMS peer with custom client settings
das-cli dbms-adapter dbms-peer run \
  --client-hostname example.io \
  --client-port 1234 \
  --client-database myDatabase \
  --client-username John \
  --context $(pwd)/context.txt
```
---

## Help

You don't need to memorize all commands. DAS CLI offers a structured help system that lets you explore everything interactively.

### List All Command Groups

```bash
das-cli --help
```

This will show the main command categories such as `db`, `metta`, `logs`, etc.

### View Help for a Command Group

To see the available subcommands within a group:

```bash
das-cli <command-group> --help
```

Example:

```bash
das-cli db --help
```

### Get Help for a Specific Subcommand

To understand how to use a specific command:

```bash
das-cli <command-group> <subcommand> --help
```

Example:

```bash
das-cli db count-atoms --help
```

### Manual Pages (APT install only)

If you installed `das-cli` via the APT package, you can also view man pages:

```bash
man das-cli
man das-cli-attention-broker-start
man das-cli-db-restart
```

> Man pages provide detailed documentation, flags, examples, and usage tips.

---

## Integration Tests

If you forgot `--recurse-submodules`, run:

```bash
git submodule update --init --recursive
```

### Without cluster tests:

```bash
make tests-local
```

### With cluster tests:

```bash
DAS_CLI_TEST_CLUSTER=true make tests-local
```

Make sure you have configured the `tests/integration/fixtures/config/redis_cluster.json` file. Replace the `username` and `ip` for the cluster nodes. For the first node, you don't need to replace the `username` as it will automatically use the current server's user where the tests are running with `das-cli`. Do not change the `context` as it will be created during test execution.

## Troubleshooting

### Docker permission denied

Add your user to the Docker group:

```bash
sudo usermod -aG docker $USER
# Restart your terminal session
```

### Temporary folder error

Ensure at least **32MB of free disk space**. DAS Toolbox extracts files to temporary folders during execution.
